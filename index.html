<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Roleta de Nomes</title>
</head>
<body>
<div style="text-align:center; font-family:Segoe UI;">
  <h2>Roleta de Nomes</h2>
  <canvas id="roleta" width="400" height="400"></canvas><br>
  <button id="girar" style="
      margin-top: 15px;
      padding: 10px 20px;
      background-color: #0078D7;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
  ">Girar</button>
  <h3 id="resultado" style="margin-top:20px; color:#333;"></h3>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const nomes = ["Gil", "Pedro", "Lucca", "Vanessa", "Cris", "Rodrigo", "Rafael"];
  const cores = ["#f94144", "#f3722c", "#f9c74f", "#90be6d", "#43aa8b", "#577590", "#9b5de5"];

  const canvas = document.getElementById("roleta");
  const ctx = canvas.getContext("2d");
  const tamanho = canvas.width / 2;
  const fatia = (2 * Math.PI) / nomes.length;
  let anguloAtual = 0; // em radianos
  let girando = false;

  function desenharRoleta() {
    for (let i = 0; i < nomes.length; i++) {
      const inicio = i * fatia;
      ctx.beginPath();
      ctx.moveTo(tamanho, tamanho);
      ctx.arc(tamanho, tamanho, tamanho, inicio, inicio + fatia);
      ctx.fillStyle = cores[i % cores.length];
      ctx.fill();

      // texto do setor
      ctx.save();
      ctx.translate(tamanho, tamanho);
      ctx.rotate(inicio + fatia / 2);
      ctx.textAlign = "right";
      ctx.fillStyle = "white";
      ctx.font = "bold 16px Segoe UI";
      ctx.fillText(nomes[i], tamanho - 10, 10);
      ctx.restore();
    }
  }

  function desenharPonteiro() {
    // ponteiro fixo no topo
    ctx.beginPath();
    ctx.moveTo(tamanho - 12, 12);
    ctx.lineTo(tamanho + 12, 12);
    ctx.lineTo(tamanho, 42);
    ctx.fillStyle = "#111";
    ctx.fill();
  }

  function desenharRotacao() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(tamanho, tamanho);
    ctx.rotate(anguloAtual);
    ctx.translate(-tamanho, -tamanho);
    desenharRoleta();
    ctx.restore();
    desenharPonteiro();
  }

  function girarRoleta() {
    if (girando) return;
    girando = true;

    // aleatório: entre 5 e 10 voltas (em graus) + um ângulo aleatório extra
    const voltas = (Math.random() * 5 + 5) * 360; // 5 a 10 voltas
    const duracao = 4200 + Math.random() * 800; // 4.2s a 5s
    const inicioTempo = Date.now();

    const animar = () => {
      const tempo = Date.now() - inicioTempo;
      const progresso = Math.min(tempo / duracao, 1);
      const easing = 1 - Math.pow(1 - progresso, 3); // desaceleração suave
      anguloAtual = (voltas * easing) * Math.PI / 180; // em radianos

      desenharRotacao();

      if (progresso < 1) {
        requestAnimationFrame(animar);
      } else {
        girando = false;
        mostrarResultado();
      }
    };
    animar();
  }

  function mostrarResultado() {
    // ponteiro está apontando para o topo -> ângulo do ponteiro em coordenadas de 0..2π:
    const ponteiroAng = (2 * Math.PI + (-Math.PI / 2)) % (2 * Math.PI); // equivalente a 3π/2
    // ângulo sob o ponteiro, relativo à roda não-rotacionada:
    // target = ponteiroAng - anguloAtual (mod 2π)
    let target = (ponteiroAng - anguloAtual) % (2 * Math.PI);
    if (target < 0) target += 2 * Math.PI;

    // índice do setor que contém esse ângulo
    const indice = Math.floor(target / fatia) % nomes.length;
    const selecionado = nomes[indice];

    document.getElementById("resultado").textContent = "Selecionado: " + selecionado;
  }

  // desenhar inicialmente
  desenharRotacao();
  document.getElementById("girar").addEventListener("click", girarRoleta);
});
</script>
</body>
</html>
